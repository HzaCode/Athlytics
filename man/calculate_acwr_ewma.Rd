% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_acwr_ewma.R
\name{calculate_acwr_ewma}
\alias{calculate_acwr_ewma}
\title{Calculate ACWR using EWMA Method with Confidence Bands}
\usage{
calculate_acwr_ewma(
  activities_data,
  activity_type = NULL,
  load_metric = "duration_mins",
  method = c("ra", "ewma"),
  acute_period = 7,
  chronic_period = 28,
  half_life_acute = 3.5,
  half_life_chronic = 14,
  start_date = NULL,
  end_date = NULL,
  user_ftp = NULL,
  user_max_hr = NULL,
  user_resting_hr = NULL,
  smoothing_period = 7,
  ci = FALSE,
  B = 200,
  block_len = 7,
  conf_level = 0.95
)
}
\arguments{
\item{activities_data}{A data frame of activities from \code{load_local_activities()}.}

\item{activity_type}{Optional. Filter activities by type. Default NULL includes all.}

\item{load_metric}{Method for calculating daily load. Default "duration_mins".}

\item{method}{ACWR calculation method: "ra" (rolling average) or "ewma". Default "ra".}

\item{acute_period}{Days for acute window (for RA method). Default 7.}

\item{chronic_period}{Days for chronic window (for RA method). Default 28.}

\item{half_life_acute}{Half-life for acute EWMA in days. Default 3.5.}

\item{half_life_chronic}{Half-life for chronic EWMA in days. Default 14.}

\item{start_date}{Optional. Analysis start date. Defaults to one year ago.}

\item{end_date}{Optional. Analysis end date. Defaults to today.}

\item{user_ftp}{Required if \code{load_metric = "tss"}.}

\item{user_max_hr}{Required if \code{load_metric = "hrss"}.}

\item{user_resting_hr}{Required if \code{load_metric = "hrss"}.}

\item{smoothing_period}{Days for smoothing ACWR. Default 7.}

\item{ci}{Logical. Whether to calculate confidence bands (EWMA only). Default FALSE.}

\item{B}{Number of bootstrap iterations (if ci = TRUE). Default 200.}

\item{block_len}{Block length for moving-block bootstrap (days). Default 7.}

\item{conf_level}{Confidence level (0-1). Default 0.95 (95\\\% CI).}
}
\value{
A data frame with columns: \code{date}, \code{atl}, \code{ctl}, \code{acwr}, \code{acwr_smooth},
and if \code{ci = TRUE} and \code{method = "ewma"}: \code{acwr_lower}, \code{acwr_upper}.
}
\description{
Calculates the Acute:Chronic Workload Ratio (ACWR) using Exponentially
Weighted Moving Average (EWMA) with optional bootstrap confidence bands.
}
\details{
This function extends the basic ACWR calculation with two methods:
\itemize{
\item \strong{RA (Rolling Average)}: Traditional rolling mean approach (default).
\item \strong{EWMA (Exponentially Weighted Moving Average)}: Uses exponential decay
with configurable half-lives. More responsive to recent changes.
}

\strong{EWMA Formula}: The smoothing parameter alpha is calculated from half-life:
\code{alpha = ln(2) / half_life}. The EWMA update is: \verb{E_t = alpha * L_t + (1-alpha) * E_\{t-1\}}
where L_t is daily load and E_t is the exponentially weighted average.

\strong{Confidence Bands}: When \code{ci = TRUE} and \code{method = "ewma"}, uses \strong{moving-block
bootstrap} to estimate uncertainty. The daily load sequence is resampled in
weekly blocks (preserving within-week correlation), ACWR is recalculated,
and percentiles form the confidence bands. This accounts for temporal correlation
in training load patterns.
}
\examples{
\dontrun{
# Load local activities
activities <- load_local_activities("export_12345678.zip")

# Calculate ACWR using Rolling Average (RA)
acwr_ra <- calculate_acwr_ewma(activities, method = "ra")

# Calculate ACWR using EWMA with confidence bands
acwr_ewma <- calculate_acwr_ewma(
  activities,
  method = "ewma",
  half_life_acute = 3.5,
  half_life_chronic = 14,
  ci = TRUE,
  B = 200
)

# Compare both methods
head(acwr_ewma)
}
}
