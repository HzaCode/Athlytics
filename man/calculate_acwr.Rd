% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_acwr.R
\name{calculate_acwr}
\alias{calculate_acwr}
\title{Calculate Acute:Chronic Workload Ratio (ACWR)}
\usage{
calculate_acwr(
  activities_data,
  activity_type = NULL,
  load_metric = "duration_mins",
  acute_period = 7,
  chronic_period = 28,
  start_date = NULL,
  end_date = NULL,
  user_ftp = NULL,
  user_max_hr = NULL,
  user_resting_hr = NULL,
  smoothing_period = 7
)
}
\arguments{
\item{activities_data}{A data frame of activities from \code{load_local_activities()}.
Must contain columns: \code{date}, \code{distance}, \code{moving_time}, \code{elapsed_time},
\code{average_heartrate}, \code{average_watts}, \code{type}, \code{elevation_gain}.}

\item{activity_type}{Optional character vector. Filter activities by type
(e.g., \code{"Run"}, \code{"Ride"}, \code{c("Run", "Ride")}). Default \code{NULL} includes all types.}

\item{load_metric}{Character string specifying the load calculation method:
\itemize{
\item \code{"duration_mins"}: Training duration in minutes (default)
\item \code{"distance_km"}: Distance in kilometers
\item \code{"elapsed_time_mins"}: Total elapsed time including stops
\item \code{"tss"}: Training Stress Score (requires \code{user_ftp})
\item \code{"hrss"}: Heart Rate Stress Score (requires \code{user_max_hr} and \code{user_resting_hr})
\item \code{"elevation_gain_m"}: Elevation gain in meters
}}

\item{acute_period}{Integer. Number of days for the acute load window (default: 7).
Represents recent training stimulus. Common values: 3-7 days.}

\item{chronic_period}{Integer. Number of days for the chronic load window (default: 28).
Represents fitness/adaptation level. Must be greater than \code{acute_period}.
Common values: 21-42 days.}

\item{start_date}{Optional. Analysis start date (YYYY-MM-DD string, Date, or POSIXct).
Defaults to one year before \code{end_date}. Earlier data is used for calculating
initial chronic load.}

\item{end_date}{Optional. Analysis end date (YYYY-MM-DD string, Date, or POSIXct).
Defaults to current date (Sys.Date()).}

\item{user_ftp}{Numeric. Your Functional Threshold Power in watts. Required only
when \code{load_metric = "tss"}. Used to normalize power-based training stress.}

\item{user_max_hr}{Numeric. Your maximum heart rate in bpm. Required only when
\code{load_metric = "hrss"}. Used for heart rate reserve calculations.}

\item{user_resting_hr}{Numeric. Your resting heart rate in bpm. Required only when
\code{load_metric = "hrss"}. Used for heart rate reserve calculations.}

\item{smoothing_period}{Integer. Number of days for smoothing the ACWR using a
rolling mean (default: 7). Reduces day-to-day noise for clearer trend visualization.}
}
\value{
A tibble with the following columns:
\describe{
\item{date}{Date (Date class)}
\item{atl}{Acute Training Load - rolling average over \code{acute_period} days (numeric)}
\item{ctl}{Chronic Training Load - rolling average over \code{chronic_period} days (numeric)}
\item{acwr}{Raw ACWR value (atl / ctl) (numeric)}
\item{acwr_smooth}{Smoothed ACWR using \code{smoothing_period} rolling mean (numeric)}
}
}
\description{
This function calculates daily training load and derives acute (short-term) and
chronic (long-term) load averages, then computes their ratio (ACWR). The ACWR
helps identify periods of rapid training load increases that may elevate injury risk.

\strong{Key Concepts:}
\itemize{
\item \strong{Acute Load (ATL)}: Rolling average of recent training (default: 7 days)
\item \strong{Chronic Load (CTL)}: Rolling average of longer-term training (default: 28 days)
\item \strong{ACWR}: Ratio of ATL to CTL (ATL / CTL)
\item \strong{Safe Zone}: ACWR between 0.8-1.3 (optimal training stimulus)
\item \strong{Danger Zone}: ACWR > 1.5 (increased injury risk)
}
}
\details{
Computes the Acute:Chronic Workload Ratio (ACWR) from local Strava activity data
using rolling average methods. ACWR is a key metric for monitoring training load
and injury risk in athletes (Gabbett, 2016; Hulin et al., 2016).

\strong{Algorithm:}
\enumerate{
\item \strong{Daily Aggregation}: Sum all activities by date to compute daily load
\item \strong{Complete Time Series}: Fill missing days with zero load (critical for ACWR accuracy)
\item \strong{Acute Load (ATL)}: Rolling mean over \code{acute_period} days (default: 7)
\item \strong{Chronic Load (CTL)}: Rolling mean over \code{chronic_period} days (default: 28)
\item \strong{ACWR Calculation}: ATL / CTL (set to NA when CTL < 0.01 to avoid division by zero)
\item \strong{Smoothing}: Optional rolling mean over \code{smoothing_period} days for visualization
}

\strong{Data Requirements:}
The function automatically fetches additional historical data (chronic_period days
before start_date) to ensure accurate chronic load calculations at the analysis
start point. Ensure your Strava export contains sufficient historical activities.

\strong{Interpretation Guidelines:}
\itemize{
\item ACWR < 0.8: May indicate detraining or insufficient load
\item ACWR 0.8-1.3: "Sweet spot" - optimal training stimulus with lower injury risk
\item ACWR 1.3-1.5: Caution zone - monitor for fatigue
\item ACWR > 1.5: High risk zone - consider load management
}

\strong{Multi-Athlete Studies:}
For cohort analyses, add an \code{athlete_id} column before calculation and use
\code{group_by(athlete_id)} with \code{do()}. See vignettes for examples.
}
\examples{
# Example using simulated data (Note: sample data is pre-calculated, shown for demonstration)
data(athlytics_sample_data)
if (!is.null(athlytics_sample_acwr)) {
  print(head(athlytics_sample_acwr))
}

\dontrun{
# Example using local Strava export data
# Step 1: Download your Strava data export
# Go to Strava.com > Settings > My Account > Download or Delete Your Account
# You'll receive a ZIP file via email (e.g., export_12345678.zip)

# Step 2: Load activities directly from ZIP (no extraction needed!)
activities <- load_local_activities("export_12345678.zip")

# Or from extracted CSV
activities <- load_local_activities("strava_export_data/activities.csv")

# Step 3: Calculate ACWR for Runs (using distance)
run_acwr <- calculate_acwr(activities_data = activities, 
                           activity_type = "Run",
                           load_metric = "distance_km")
print(tail(run_acwr))

# Calculate ACWR for Rides (using TSS, requires FTP)
ride_acwr_tss <- calculate_acwr(activities_data = activities,
                                activity_type = "Ride",
                                load_metric = "tss", 
                                user_ftp = 280)
print(tail(ride_acwr_tss))

# Plot the results
plot_acwr(run_acwr, highlight_zones = TRUE)
}
}
\references{
Gabbett, T. J. (2016). The training-injury prevention paradox: should athletes
be training smarter and harder? \emph{British Journal of Sports Medicine}, 50(5), 273-280.

Hulin, B. T., et al. (2016). The acute:chronic workload ratio predicts injury:
high chronic workload may decrease injury risk in elite rugby league players.
\emph{British Journal of Sports Medicine}, 50(4), 231-236.
}
\seealso{
\code{\link{plot_acwr}} for visualization,
\code{\link{calculate_acwr_ewma}} for EWMA-based ACWR,
\code{\link{load_local_activities}} for data loading,
\code{\link{cohort_reference}} for multi-athlete comparisons
}
