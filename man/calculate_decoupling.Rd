% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_decoupling.R
\name{calculate_decoupling}
\alias{calculate_decoupling}
\title{Calculate Aerobic Decoupling}
\usage{
calculate_decoupling(
  stoken,
  activity_type = c("Run", "Ride"),
  decouple_metric = c("Pace_HR", "Power_HR"),
  start_date = NULL,
  end_date = NULL,
  min_duration_mins = 45,
  max_activities = 50,
  stream_df = NULL
)
}
\arguments{
\item{stoken}{A valid Strava token from `rStrava::strava_oauth()`.}

\item{activity_type}{Type(s) of activities to analyze (e.g., "Run", "Ride").}

\item{decouple_metric}{Basis for calculation: "Pace_HR" or "Power_HR".}

\item{start_date}{Optional. Analysis start date (YYYY-MM-DD string or Date). Defaults to one year ago.}

\item{end_date}{Optional. Analysis end date (YYYY-MM-DD string or Date). Defaults to today.}

\item{min_duration_mins}{Minimum activity duration (minutes) to include. Default 45.}

\item{max_activities}{Maximum number of recent activities to analyze. Default 50.}

\item{stream_df}{Optional. A pre-fetched data frame for a *single* activity's stream.
If provided, calculates decoupling for this data directly, ignoring `stoken` and
other fetching parameters. Must include columns: `time`, `heartrate`, and either
`velocity_smooth`/`distance` (for Pace_HR) or `watts` (for Power_HR).}
}
\value{
If `stream_df` is NOT provided: A data frame with columns `date` and
  `decoupling` (percentage) for activities meeting the criteria.
  If `stream_df` IS provided: A single numeric value representing the
  decoupling percentage for that specific stream.
}
\description{
Calculates aerobic decoupling for Strava activities.
}
\details{
Analyzes heart rate and either pace or power data from activity streams
to determine the percentage of decoupling, indicating aerobic fitness changes
during an activity. Requires fetching detailed stream data via the Strava API,
which can be slow.

This function provides the data used by `plot_decoupling`.
  It compares the efficiency factor (output/heart rate) between the first
  and second halves of each activity. A positive decoupling percentage suggests
  a decline in efficiency (i.e., heart rate drift).
  Fetching streams from the Strava API can be time-consuming and subject to rate limits.
}
\examples{
\dontrun{
# Requires authentication first:
# stoken <- rStrava::strava_oauth(..., cache = TRUE)

# Calculate Pace/HR decoupling for recent Runs (limit to 10 for speed)
run_decoupling <- calculate_decoupling(
    stoken = stoken,
    activity_type = "Run",
    decouple_metric = "Pace_HR",
    max_activities = 10
)
print(tail(run_decoupling))

# Example with pre-fetched stream data (replace ... with actual stream df)
# single_activity_decoupling <- calculate_decoupling(stream_df = ... , decouple_metric = "Power_HR")
# print(single_activity_decoupling)
}
}
