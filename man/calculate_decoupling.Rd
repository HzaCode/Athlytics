% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_decoupling.R
\name{calculate_decoupling}
\alias{calculate_decoupling}
\title{Calculate Aerobic Decoupling}
\usage{
calculate_decoupling(
  activities_data = NULL,
  export_dir = "strava_export_data",
  activity_type = c("Run", "Ride"),
  decouple_metric = c("Pace_HR", "Power_HR"),
  start_date = NULL,
  end_date = NULL,
  min_duration_mins = 40,
  stream_df = NULL,
  stoken = NULL
)
}
\arguments{
\item{activities_data}{A data frame from \code{load_local_activities()}. Required unless \code{stream_df} is provided.}

\item{export_dir}{Base directory of Strava export containing the activities folder.
Default is "strava_export_data".}

\item{activity_type}{Type(s) of activities to analyze (e.g., "Run", "Ride").}

\item{decouple_metric}{Basis for calculation: "Pace_HR" or "Power_HR".}

\item{start_date}{Optional. Analysis start date (YYYY-MM-DD string or Date). Defaults to one year ago.}

\item{end_date}{Optional. Analysis end date (YYYY-MM-DD string or Date). Defaults to today.}

\item{min_duration_mins}{Minimum activity duration (minutes) to include. Default 40.}

\item{stream_df}{Optional. A pre-fetched data frame for a \emph{single} activity's stream.
If provided, calculates decoupling for this data directly, ignoring other parameters.
Must include columns: \code{time}, \code{heartrate}, and either \code{velocity_smooth}/\code{distance}
(for Pace_HR) or \code{watts} (for Power_HR).}

\item{stoken}{\strong{Deprecated.} Legacy Strava token parameter maintained for backward compatibility only.}
}
\value{
Returns a data frame with \code{date} and \code{decoupling} (\\\%) columns, OR
a single numeric decoupling value if \code{stream_df} is provided.
}
\description{
Calculates aerobic decoupling for Strava activities from local export data.
}
\details{
Calculates aerobic decoupling (HR drift relative to pace/power) using detailed
activity stream data from local FIT/TCX/GPX files.

Provides data for \code{plot_decoupling}. Compares output/HR efficiency
between first and second halves of activities. Positive values indicate
HR drift (cardiovascular drift).

\strong{Best practice}: Use \code{load_local_activities()} to load data, then pass to this function.

The function parses FIT/TCX/GPX files from your Strava export to extract detailed
stream data (time, heartrate, distance/power). Activities are split into two halves,
and the efficiency factor (output/HR) is compared between halves.
}
\examples{
# Example using simulated data
data(Athlytics_sample_data)
print(head(athlytics_sample_decoupling))

\dontrun{
# Load local activities
activities <- load_local_activities("strava_export_data/activities.csv")

# Calculate Pace/HR decoupling for recent runs
run_decoupling <- calculate_decoupling(
    activities_data = activities,
    export_dir = "strava_export_data",
    activity_type = "Run",
    decouple_metric = "Pace_HR",
    start_date = "2024-01-01"
)
print(tail(run_decoupling))

# Calculate for a single activity stream
# stream_data <- parse_activity_file("strava_export_data/activities/12345.fit")
# single_decoupling <- calculate_decoupling(stream_df = stream_data, decouple_metric = "Pace_HR")
}
}
